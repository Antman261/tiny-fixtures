<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>tiny-fixtures</title>
	<meta name="description" content="Documentation for tiny-fixtures">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">tiny-fixtures</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>tiny-fixtures</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#tiny-fixtures" id="tiny-fixtures" style="color: inherit; text-decoration: none;">
					<h1>Tiny Fixtures</h1>
				</a>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<p>Run <code>npm i -D tiny-fixtures</code> to save to your dev dependencies.</p>
				<a href="#compatibility" id="compatibility" style="color: inherit; text-decoration: none;">
					<h2>Compatibility</h2>
				</a>
				<p>Currently, only tested against Postgres flavoured SQL and assumes a node-postgres pool</p>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<p>Start by initialising a fixture manager with a connection.
				This will return an object containing a <code>createFixtures</code> function.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">tinyFixtures</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;tiny-fixtures&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">pool</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;./db/connection&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">getUsers</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;/db/users&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">createFixtures</span><span style="color: #000000"> } = </span><span style="color: #795E26">tinyFixtures</span><span style="color: #000000">(</span><span style="color: #001080">pool</span><span style="color: #000000">)</span>

<span style="color: #795E26">describe</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;my test cases&#039;</span><span style="color: #000000">, () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> [</span><span style="color: #0070C1">setupUserFixtures</span><span style="color: #000000">, </span><span style="color: #0070C1">teardownUserFixtures</span><span style="color: #000000">] = </span><span style="color: #795E26">createFixtures</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;users&#039;</span><span style="color: #000000">, [</span>
<span style="color: #000000">        {</span>
<span style="color: #000000">            </span><span style="color: #001080">email:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;foo@bar.co&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">username:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;tinyAnt&#039;</span>
<span style="color: #000000">        }, {</span>
<span style="color: #000000">            </span><span style="color: #001080">email:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;bar@foo.co&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">            </span><span style="color: #001080">username:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;antTiny&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">        }</span>
<span style="color: #000000">    ]);</span>
<span style="color: #000000">    </span><span style="color: #795E26">beforeEach</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">setupUserFixtures</span><span style="color: #000000">();</span>
<span style="color: #000000">    });</span>
<span style="color: #000000">    </span><span style="color: #795E26">afterEach</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">teardownUserFixtures</span><span style="color: #000000">();</span>
<span style="color: #000000">    });</span>
<span style="color: #000000">    </span><span style="color: #795E26">it</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;should have two users in the database&#039;</span><span style="color: #000000">, </span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #795E26">expect</span><span style="color: #000000">((</span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">getUsers</span><span style="color: #000000">()).</span><span style="color: #001080">length</span><span style="color: #000000">).</span><span style="color: #001080">to</span><span style="color: #000000">.</span><span style="color: #795E26">equal</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">);</span>
<span style="color: #000000">    });</span>
<span style="color: #000000">})</span>
</code></pre>
				<p><code>createFixtures</code> takes a table name as its first arg, and an array of objects
					where each object is a row to insert, where the keys are columns,
				and the values are the value for that column in that row.</p>
				<p>It will then return two functions, one to setup the fixtures, and one to tear them down.
					Simply call each of these functions in your before each and after each hooks and voila,
				you&#39;ve got clean test data for each test, and it won&#39;t interfere with your existing data.</p>
				<p>If you need to create fixtures across foreign keys then use the third value returned
					by <code>createFixtures</code> to populate the next table, being sure to correctly order your
				setup and teardown steps.</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">tinyFixtures</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;tiny-fixtures&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">pool</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;./db/connection&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">getUsers</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;/db/users&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">createFixtures</span><span style="color: #000000"> } = </span><span style="color: #795E26">tinyFixtures</span><span style="color: #000000">(</span><span style="color: #001080">pool</span><span style="color: #000000">);</span>

<span style="color: #795E26">describe</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;my test cases&#039;</span><span style="color: #000000">, () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> [</span><span style="color: #0070C1">setupUserFixtures</span><span style="color: #000000">, </span><span style="color: #0070C1">teardownUserFixtures</span><span style="color: #000000">, </span><span style="color: #0070C1">users</span><span style="color: #000000">] = </span><span style="color: #795E26">createFixtures</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;users&#039;</span><span style="color: #000000">, [</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">email:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;foo@bar.co&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">username:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;tinyAnt&#039;</span>
<span style="color: #000000">    }, {</span>
<span style="color: #000000">      </span><span style="color: #001080">email:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;bar@foo.co&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      </span><span style="color: #001080">username:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;antTiny&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  ]);</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> [</span><span style="color: #0070C1">setupUserMessageFixtures</span><span style="color: #000000">, </span><span style="color: #0070C1">teardownUserMessageFixtures</span><span style="color: #000000">] = </span><span style="color: #795E26">createFixtures</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #A31515">&#039;user_messages&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    [{</span>
<span style="color: #000000">        </span><span style="color: #001080">user_id:</span><span style="color: #000000"> </span><span style="color: #001080">users</span><span style="color: #000000">[</span><span style="color: #098658">0</span><span style="color: #000000">].</span><span style="color: #795E26">getRefByKey</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;id&#039;</span><span style="color: #000000">),</span>
<span style="color: #000000">        </span><span style="color: #001080">message:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Foobar did the bar foo good&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">      },</span>
<span style="color: #000000">      {</span>
<span style="color: #000000">        </span><span style="color: #001080">user_id:</span><span style="color: #000000"> </span><span style="color: #001080">users</span><span style="color: #000000">[</span><span style="color: #098658">0</span><span style="color: #000000">].</span><span style="color: #795E26">getRefByKey</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;id&#039;</span><span style="color: #000000">),</span>
<span style="color: #000000">        </span><span style="color: #001080">message:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;I am a meat popsicle&#039;</span><span style="color: #000000">, </span>
<span style="color: #000000">    }]</span>
<span style="color: #000000">  )</span>
<span style="color: #000000">  </span><span style="color: #795E26">beforeEach</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">setupUserFixtures</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">setupUserMessageFixtures</span><span style="color: #000000">();</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">  </span><span style="color: #795E26">afterEach</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">teardownUserMessageFixtures</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">teardownUserFixtures</span><span style="color: #000000">();</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">  </span><span style="color: #795E26">it</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;should have a user with two messages, and one with none&#039;</span><span style="color: #000000">, </span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">users</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">getUsers</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #795E26">expect</span><span style="color: #000000">(</span><span style="color: #001080">users</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000">).</span><span style="color: #001080">to</span><span style="color: #000000">.</span><span style="color: #795E26">equal</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #795E26">expect</span><span style="color: #000000">(</span><span style="color: #001080">users</span><span style="color: #000000">[</span><span style="color: #098658">0</span><span style="color: #000000">].</span><span style="color: #001080">messages</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000">).</span><span style="color: #001080">to</span><span style="color: #000000">.</span><span style="color: #795E26">equal</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">);</span>
<span style="color: #000000">    </span><span style="color: #795E26">expect</span><span style="color: #000000">(</span><span style="color: #001080">users</span><span style="color: #000000">[</span><span style="color: #098658">1</span><span style="color: #000000">].</span><span style="color: #001080">messages</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000">).</span><span style="color: #001080">to</span><span style="color: #000000">.</span><span style="color: #795E26">equal</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">);</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">})</span>
</code></pre>
				<p>Pay attention to the ordering -- following these simple patterns is what keeps tiny-fixtures tiny!</p>
				<p><strong><em>Whats up with <code>user_id: users[0].getRefByKey(&#39;id&#39;)</code> ?</em></strong></p>
				<p>Since the fixture hasn&#39;t been inserted into the database yet, we don&#39;t have any serial/sequence values yet. This function takes the column name of the primary key for the parent object in the foreign key, allowing the value to be resolved when the setup step occurs. </p>
				<p>How? Well when the setup step runs for the child table, it sees the output of this function as a flag, looks up the result for that column in the original object, and populates its value before continuing the insert.</p>
				<a href="#docs" id="docs" style="color: inherit; text-decoration: none;">
					<h3>Docs</h3>
				</a>
				<p>Full documentation located at <a href="https://github.com/Antman261/tiny-fixtures/tree/main/docs">https://github.com/Antman261/tiny-fixtures/tree/main/docs</a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#createfixtures" class="tsd-kind-icon">Create<wbr>Fixtures</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#resultarray" class="tsd-kind-icon">Result<wbr>Array</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#rowhelpers" class="tsd-kind-icon">Row<wbr>Helpers</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#setupfixtures" class="tsd-kind-icon">Setup<wbr>Fixtures</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#teardownfixtures" class="tsd-kind-icon">Teardown<wbr>Fixtures</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="modules.html#tinyfixtures" class="tsd-kind-icon">Tiny<wbr>Fixtures</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#tinyfixtures" class="tsd-kind-icon">tiny<wbr>Fixtures</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>